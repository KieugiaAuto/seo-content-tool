<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Táº¡o ná»™i dung SEO cho Kiá»u Gia Auto</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f4f4f4;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }
    h1 {
      text-align: center;
      color: #333;
    }
    .form-group {
      margin-bottom: 15px;
    }
    label {
      display: block;
      font-weight: bold;
      margin-bottom: 5px;
    }
    input, select {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      box-sizing: border-box;
    }
    button {
      background-color: #28a745;
      color: #fff;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover {
      background-color: #218838;
    }
    .button-container {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    #preview {
      padding: 15px;
      border: 1px solid #ddd;
      border-radius: 4px;
      background-color: #f9f9f9;
    }
    @media (max-width: 600px) {
      .button-container {
        flex-direction: column;
      }
      button {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Táº¡o ná»™i dung SEO cho Kiá»u Gia Auto</h1>
    <div class="form-group">
      <label for="ten">TÃªn phá»¥ tÃ¹ng:</label>
      <input type="text" id="ten" placeholder="VÃ­ dá»¥: CÃ ng A Suzuki Swift 2013-2018">
    </div>
    <div class="form-group">
      <label for="ma">MÃ£ sáº£n pháº©m:</label>
      <input type="text" id="ma" placeholder="VÃ­ dá»¥: CANGA123">
    </div>
    <div class="form-group">
      <label for="thuonghieu">ThÆ°Æ¡ng hiá»‡u:</label>
      <input type="text" id="thuonghieu" placeholder="VÃ­ dá»¥: Suzuki">
    </div>
    <div class="form-group">
      <label for="xuatxu">Xuáº¥t xá»©:</label>
      <input type="text" id="xuatxu" placeholder="VÃ­ dá»¥: Nháº­t Báº£n">
    </div>
    <div class="form-group">
      <label for="website">Chá»n website:</label>
      <select id="website">
        <option value="phutunggiare">Phá»¥ tÃ¹ng giÃ¡ ráº»</option>
        <option value="kieugiaauto">Kiá»u Gia Auto</option>
        <option value="banphutung">BÃ¡n phá»¥ tÃ¹ng</option>
        <option value="phutungotokieugia">Phá»¥ tÃ¹ng Ã´ tÃ´ Kiá»u Gia</option>
        <option value="shopee">Shopee</option>
      </select>
    </div>
    <div class="button-container">
      <button onclick="taoNoiDung()">Táº¡o ná»™i dung</button>
      <button id="copyButton" onclick="saoChepNoiDung()" style="display: none;">ğŸ“‹ Sao chÃ©p ná»™i dung</button>
    </div>
    <div id="preview"></div>
  </div>

  <script src="moTaTheoLoai.js"></script>
  <script>
    // HÃ m loáº¡i bá» dáº¥u tiáº¿ng Viá»‡t Ä‘á»ƒ xá»­ lÃ½ tá»« khÃ³a
    function removeVietnameseTones(str) {
      return str
        .normalize('NFD')
        .replace(/[\u0300-\u036f]/g, '')
        .replace(/Ä‘/g, 'd')
        .replace(/Ä/g, 'D');
    }

    // ============================
// AUTO REROLL MÃ” Táº¢ (chá»‘ng trÃ¹ng giá»¯a 4 web)
// ============================
const KG_TRACK_SITES = new Set(['kieugiaauto','phutunggiare','banphutung','phutungotokieugia']);

function kgNormalizeText(s) {
  return (s || '')
    .toString()
    .replace(/<[^>]*>/g, ' ')
    .replace(/\s+/g, ' ')
    .trim()
    .toLowerCase();
}

// ===== NEAR DUPLICATE CHECK (Jaccard >= 80%) =====
function kgTokenize(s) {
  const t = removeVietnameseTones(kgNormalizeText(s))
    .replace(/[^a-z0-9\s]/g, ' ')
    .replace(/\s+/g, ' ')
    .trim();

  if (!t) return [];

  return t.split(' ').filter(w => w.length >= 2);
}

function kgJaccardSim(a, b) {
  const A = new Set(kgTokenize(a));
  const B = new Set(kgTokenize(b));

  if (A.size === 0 || B.size === 0) return 0;

  let inter = 0;
  for (const x of A) if (B.has(x)) inter++;

  const uni = A.size + B.size - inter;
  return uni ? (inter / uni) : 0;
}


function kgKeyNormalize(s) {
  return removeVietnameseTones((s || '').toString())
    .toLowerCase()
    .replace(/[^a-z0-9]+/g, '')   // âœ… bá» luÃ´n dáº¥u -, space, / ...
    .trim();
}


// âœ… Æ¯u tiÃªn MA (SKU) Ä‘á»ƒ key luÃ´n giá»‘ng nhau giá»¯a cÃ¡c web
function kgMakeProductKey(ten, ma) {
  const sku = kgKeyNormalize(ma);
  if (sku) return `sku__${sku}`;

  const name = kgKeyNormalize(ten);
  return `name__${name}`;
}

function kgLoadDescStore() {
  try { return JSON.parse(localStorage.getItem('kg_desc_store') || '{}'); }
  catch (e) { return {}; }
}
function kgSaveDescStore(store) {
  localStorage.setItem('kg_desc_store', JSON.stringify(store));
}

// =========================
// TTL 20 ngÃ y + Auto Purge khi Ä‘áº§y
// =========================
const KG_TTL_DAYS = 20;
const KG_TTL_MS = KG_TTL_DAYS * 24 * 60 * 60 * 1000;

function kgNormalizeStore(store) {
  const now = Date.now();
  let changed = false;

  for (const pkey of Object.keys(store || {})) {
    const sites = store[pkey] || {};
    for (const site of Object.keys(sites)) {
      const item = sites[site];

      if (typeof item === 'string') {
        sites[site] = { desc: item, ts: now };
        changed = true;
        continue;
      }

      if (item && typeof item === 'object' && item.desc && !item.ts) {
        item.ts = now;
        changed = true;
      }
    }
    store[pkey] = sites;
  }

  return { store, changed };
}


function kgListAllEntries(store) {
  const rows = [];
  for (const pkey of Object.keys(store || {})) {
    for (const site of Object.keys((store[pkey] || {}))) {
      const item = store[pkey][site];
      const ts = (item && typeof item === 'object' && item.ts) ? item.ts : 0;
      rows.push({ pkey, site, ts });
    }
  }
  rows.sort((a, b) => (a.ts || 0) - (b.ts || 0));
  return rows;
}

function kgDeleteEntry(store, pkey, site) {
  if (!store[pkey]) return;
  delete store[pkey][site];
  if (!Object.keys(store[pkey]).length) delete store[pkey];
}

function kgPurgeExpiredOnly(store) {
  const now = Date.now();

  for (const pkey of Object.keys(store || {})) {
    const sites = store[pkey] || {};

    for (const site of Object.keys(sites)) {
      const item = sites[site];
      const ts = (item && typeof item === 'object' && item.ts) ? item.ts : 0;

      if (!ts || (now - ts) >= KG_TTL_MS) {
        delete sites[site];
      }
    }

    if (!Object.keys(sites).length) {
      delete store[pkey];
    }
  }

  return store;
}

function kgSaveDescStoreSafe(store) {
  // normalize trÆ°á»›c (khÃ´ng xoÃ¡)
  const norm = kgNormalizeStore(store);
  store = norm.store;

  const trySave = () => localStorage.setItem('kg_desc_store', JSON.stringify(store));

  try {
    trySave();
    return true;
  } catch (e) {
    // âœ… chá»‰ khi localStorage Ä‘áº§y má»›i purge nhá»¯ng cÃ¡i > 20 ngÃ y
    store = kgPurgeExpiredOnly(store);

    try {
      trySave();
      return true;
    } catch (e2) {
      // váº«n Ä‘áº§y mÃ  khÃ´ng cÃ³ gÃ¬ quÃ¡ 20 ngÃ y Ä‘á»ƒ xoÃ¡
      return false;
    }
  }
}

// LÆ¯U mÃ´ táº£ Ä‘Ã£ dÃ¹ng cho 1 sáº£n pháº©m + 1 web
function kgCommitDesc(productKey, website, descHtml) {
  let store = kgLoadDescStore();

  // normalize format cÅ© náº¿u cÃ³
  const norm = kgNormalizeStore(store);
  store = norm.store;

  if (!store[productKey]) store[productKey] = {};

  store[productKey][website] = {
    desc: kgNormalizeText(descHtml),
    ts: Date.now()
  };

  // âœ… Dá»ŒN ngay cÃ¡c entry >= 20 ngÃ y
  store = kgPurgeExpiredOnly(store);

  const ok = kgSaveDescStoreSafe(store);
  if (!ok) console.warn('kg_desc_store Ä‘áº§y, khÃ´ng thá»ƒ lÆ°u.');
}

// CHECK trÃ¹ng tuyá»‡t Ä‘á»‘i (bÆ°á»›c #1 chá»‰ cáº§n tháº¿ nÃ y)
function kgIsDuplicateDesc(productKey, website, descHtml, threshold = 0.8) {
  let store = kgLoadDescStore();

  // normalize store (khÃ´ng xoÃ¡)
  const norm = kgNormalizeStore(store);
  store = norm.store;
  if (norm.changed) kgSaveDescStore(store);

  const used = store[productKey] || {};
  const curN = kgNormalizeText(descHtml);
  const now = Date.now();

  for (const [site, saved] of Object.entries(used)) {
    if (site === website || !saved) continue;

    const savedDescN = (typeof saved === 'object' && saved.desc) ? saved.desc : String(saved);
    const ts = (typeof saved === 'object' && saved.ts) ? saved.ts : now; 

    // âœ… chá»‰ check trong 20 ngÃ y
    if (now - ts > KG_TTL_MS) continue;

    if (savedDescN === curN) {
      return { duplicate: true, conflictSite: site, similarity: 1, exact: true };
    }

    const sim = kgJaccardSim(savedDescN, curN);
    if (sim >= threshold) {
      return { duplicate: true, conflictSite: site, similarity: sim, exact: false };
    }
  }

  return { duplicate: false, similarity: 0, exact: false };
}
   // HÃ m táº¡o mÃ´ táº£ SEO tá»± Ä‘á»™ng dá»±a trÃªn tÃªn phá»¥ tÃ¹ng
    function sinhMoTaTuDong(ten) {
      const regex = /(.*?)(ac|acura|aeolus|alfa_romeo|alpine|aston_martin|audi|bac|bahman|baic|bentley|bmw|bollinger|brilliance|bugatti|buick|byd|cadillac|callaway|carver|chery|chevrolet|chrysler|citroen|cupra|daihatsu|dodge|ds|ferrari|fiat|fisker|ford|geely|genesis|gmc|haval|hino|honda|hummer|hyundai|infiniti|isuzu|jaguar|jeep|kia|lamborghini|land_rover|lexus|lincoln|lotus|lucid|maserati|maybach|mazda|mclaren|mercedes_benz|mg|mini|mitsubishi|nissan|opel|pagani|peugeot|porsche|ram|renault|rivian|rolls_royce|saic|seat|skoda|smart|ssangyong|subaru|suzuki|tesla|toyota|vinfast|volkswagen|volvo|daewoo|mercedes)[\s-]+([a-zA-Z0-9\s.]+)(?:\s+(\d{4})(?:\D+(\d{4}))?)?$/i;
      const match = ten.match(regex);
if (!match) {
  return `<p>Phá»¥ tÃ¹ng Ã´ tÃ´ cháº¥t lÆ°á»£ng cao, tÆ°Æ¡ng thÃ­ch vá»›i nhiá»u dÃ²ng xe, Ä‘áº£m báº£o hiá»‡u suáº¥t vÃ  Ä‘á»™ bá»n tá»‘i Æ°u.</p>`;
}

      const tenPhuTung = match[1].trim();
      const hang = match[2].replace('_', '-').split('-').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
      const dong = match[3].trim();
      const nam1 = match[4] || '';
      const nam2 = match[5] || '';
      const dateText = nam1 ? (nam2 ? ` tá»« ${nam1} Ä‘áº¿n ${nam2}` : ` Ä‘á»i ${nam1}`) : '';
      const website = document.getElementById('website').value;

      let gioiThieu = '';

      // TÃ¡ch tenPhuTung thÃ nh cÃ¡c pháº§n vÃ  táº¡o danh sÃ¡ch biáº¿n thá»ƒ
      const tenPhuTungParts = tenPhuTung.split(' ');
      const tenPhuTungVariants = [];
      for (let i = tenPhuTungParts.length; i >= 2; i--) { // Báº¯t Ä‘áº§u tá»« Ä‘á»™ dÃ i lá»›n nháº¥t, tá»‘i thiá»ƒu 2 tá»«
        tenPhuTungVariants.push(tenPhuTungParts.slice(0, i).join(' ').trim());
      }

      // Táº¡o danh sÃ¡ch tá»« khÃ³a theo thá»© tá»± Æ°u tiÃªn
      const keywords = [];
      // 1. ToÃ n bá»™ tÃªn phá»¥ tÃ¹ng
      const fullKey = `${tenPhuTung} ${hang} ${dong}${nam1 ? ` ${nam1}` : ''}${nam2 ? ` ${nam2}` : ''}`.trim();
      keywords.push(fullKey);
      // 2. Pháº§n phá»¥ tÃ¹ng + hÃ£ng + dÃ²ng + nÄƒm Ä‘áº§u (náº¿u cÃ³)
      if (nam1) {
        keywords.push(`${tenPhuTung} ${hang} ${dong} ${nam1}`.trim());
      }
      // 3. Pháº§n phá»¥ tÃ¹ng + hÃ£ng + dÃ²ng
      keywords.push(`${tenPhuTung} ${hang} ${dong}`.trim());
      // 4. Pháº§n phá»¥ tÃ¹ng + hÃ£ng
      keywords.push(`${tenPhuTung} ${hang}`.trim());
      // 5. Chá»‰ pháº§n phá»¥ tÃ¹ng
      keywords.push(tenPhuTung);
      // 6. CÃ¡c biáº¿n thá»ƒ cá»§a tenPhuTung (bá» dáº§n tá»« cuá»‘i)
      keywords.push(...tenPhuTungVariants);

      // Chuáº©n hÃ³a vÃ  so khá»›p tá»«ng tá»« khÃ³a
      try {
        const tuKhoaList = Object.keys(moTaTheoLoai).sort((a, b) => b.length - a.length);
        for (const keyword of keywords) {
          const keywordNoTones = removeVietnameseTones(keyword).toLowerCase().replace(/\s+/g, ' ').trim();
          for (const tuKhoa of tuKhoaList) {
            const tuKhoaNoTones = removeVietnameseTones(tuKhoa).toLowerCase().replace(/\s+/g, ' ').trim();
            if (keywordNoTones === tuKhoaNoTones) {
              const dsMoTa = moTaTheoLoai[tuKhoa];
              gioiThieu = dsMoTa[Math.floor(Math.random() * dsMoTa.length)];
              break;
            }
          }
          if (gioiThieu) break; // ThoÃ¡t vÃ²ng láº·p náº¿u Ä‘Ã£ tÃ¬m tháº¥y mÃ´ táº£
        }
      } catch (err) {
        console.error('Lá»—i khi truy cáº­p moTaTheoLoai:', err);
      }

            // Náº¿u váº«n khÃ´ng cÃ³ mÃ´ táº£ tá»« moTaTheoLoai, dÃ¹ng mÃ´ táº£ máº·c Ä‘á»‹nh
            if (!gioiThieu) {
        gioiThieu = 'Phá»¥ tÃ¹ng Ã´ tÃ´ cháº¥t lÆ°á»£ng cao, tÆ°Æ¡ng thÃ­ch vá»›i nhiá»u dÃ²ng xe, Ä‘áº£m báº£o hiá»‡u suáº¥t vÃ  Ä‘á»™ bá»n tá»‘i Æ°u.';
      }

      // ===== AUTO REROLL CHá»NG TRÃ™NG =====
      const maInput = (document.getElementById('ma')?.value || '').trim();
      const productKey = kgMakeProductKey(ten, maInput);

      const MAX_REROLL = 8;
      let lastMoTa = '';

      for (let attempt = 1; attempt <= MAX_REROLL; attempt++) {

        const moTaMau = {
          kieugiaauto: [
            `${gioiThieu} Sáº£n pháº©m phÃ¹ há»£p vá»›i ${hang} ${dong}${dateText}, dá»… láº¯p Ä‘áº·t, Ä‘Æ°á»£c báº£o hÃ nh Ä‘áº§y Ä‘á»§.`,
            `${gioiThieu} ÄÆ°á»£c thiáº¿t káº¿ dÃ nh riÃªng cho ${hang} ${dong}${dateText}, Ä‘áº£m báº£o chÃ­nh hÃ£ng vá»›i giÃ¡ cáº¡nh tranh.`
          ],
          phutungotokieugia: [
            `${gioiThieu} TÆ°Æ¡ng thÃ­ch vá»›i ${hang} ${dong}${dateText}, Ä‘Æ°á»£c nhiá»u gara tin dÃ¹ng.`,
            `${gioiThieu} Há»— trá»£ ká»¹ thuáº­t táº­n tÃ¢m, phÃ¹ há»£p hoÃ n háº£o cho ${hang} ${dong}${dateText}.`
          ],
          banphutung: [
            `${gioiThieu} PhÃ¹ há»£p vá»›i ${hang} ${dong}${dateText}, luÃ´n cÃ³ sáºµn vÃ  giao hÃ ng toÃ n quá»‘c.`,
            `${gioiThieu} GÃ³p pháº§n báº£o vá»‡ vÃ  nÃ¢ng cao hiá»‡u suáº¥t cho ${hang} ${dong}${dateText}.`
          ],
          phutunggiare: [
            `${gioiThieu} TÆ°Æ¡ng thÃ­ch vá»›i ${hang} ${dong}${dateText}, giÃ¡ tiáº¿t kiá»‡m, báº£o hÃ nh Ä‘áº§y Ä‘á»§.`,
            `${gioiThieu} Lá»±a chá»n chÃ­nh hÃ£ng, tiáº¿t kiá»‡m chi phÃ­ cho ${hang} ${dong}${dateText}.`
          ],
          shopee: [
            `${gioiThieu} PhÃ¹ há»£p vá»›i ${hang} ${dong}${dateText}, giÃ¡ Æ°u Ä‘Ã£i trÃªn Shopee.`,
            `${gioiThieu} Sáº£n pháº©m cháº¥t lÆ°á»£ng cao cho ${hang} ${dong}${dateText}, giao hÃ ng nhanh chÃ³ng.`
          ]
        };

        const mau = moTaMau[website];
        if (!mau || !gioiThieu) return '';

        let moTa = `<p>${mau[Math.floor(Math.random() * mau.length)]}</p>`;

        if (website === 'kieugiaauto' || website === 'phutungotokieugia') {
          const linkTrangChu = website === 'kieugiaauto' ? 'https://kieugiaauto.vn' : 'https://phutungotokieugia.vn';
          const regex = new RegExp(`\\b${hang}\\b(?![^<]*>)`, 'i');
          moTa = moTa.replace(regex, `<a href="${linkTrangChu}/${hang.toLowerCase().replace(' ', '-')}" target="_blank">${hang}</a>`);
        }

        lastMoTa = moTa;

        // Chá»‰ check trÃ¹ng cho 4 web chÃ­nh (shopee khÃ´ng tÃ­nh)
        if (KG_TRACK_SITES.has(website)) {
          const dup = kgIsDuplicateDesc(productKey, website, moTa);
          if (dup.duplicate) {
            // trÃ¹ng -> reroll tiáº¿p
            continue;
          }
        }

        // OK -> tráº£ vá»
        return moTa;
      }

      // Náº¿u reroll váº«n trÃ¹ng (xui), tráº£ vá» cÃ¡i cuá»‘i cÃ¹ng
      return lastMoTa;
    }

    // HÃ m táº¡o danh sÃ¡ch xe phÃ¹ há»£p cho website Shopee
    function sinhDanhSachXe(ten, thuonghieu, isShopee = false) {
      if (!isShopee) {
        return '';
      }

      if (!ten || !thuonghieu) {
        return `<h3>PhÃ¹ há»£p vá»›i cÃ¡c dÃ²ng xe:</h3><p>TÆ°Æ¡ng thÃ­ch vá»›i cÃ¡c dÃ²ng xe thuá»™c thÆ°Æ¡ng hiá»‡u ${thuonghieu}</p>`;
      }
      ten = ten.toLowerCase();

      const hangXeMap = {
        ac: ["Ace", "Cobra"],
        acura: ["ILX", "MDX", "NSX", "RDX", "TLX"],
        aeolus: ["A30", "A60", "AX7"],
        alfa_romeo: ["Giulia", "Stelvio", "Tonale"],
        alpine: ["A110"],
        aston_martin: ["DB11", "DBS", "Vantage", "Valhalla"],
        audi: ["A3", "A4", "A6", "Q3", "Q5", "Q7", "e-tron"],
        bac: ["Mono"],
        bahman: ["Faw", "Capra"],
        baic: ["X55", "BJ40", "Senova", "M50"],
        bentley: ["Bentayga", "Continental GT", "Flying Spur"],
        bmw: ["3 Series", "5 Series", "7 Series", "X1", "X3", "X5", "i4", "iX"],
        bollinger: ["B1", "B2"],
        brilliance: ["V5", "H530"],
        bugatti: ["Chiron", "Divo"],
        buick: ["Enclave", "Encore", "Envision"],
        byd: ["F0", "F3", "Dolphin", "Atto 3", "Seal", "Han"],
        cadillac: ["Escalade", "CTS", "XT5", "CT5", "Lyriq"],
        callaway: ["Corvette C7", "Camaro"],
        carver: ["One"],
        chery: ["QQ", "Arrizo 3", "Arrizo 5", "Arrizo 6", "Tiggo 2", "Tiggo 3", "Tiggo 4", "Tiggo 5", "Tiggo 7", "Tiggo 8", "Omoda 5"],
        chevrolet: ["Spark", "Aveo", "Cruze", "Lacetti", "Optra", "Captiva", "Orlando", "Colorado", "Trailblazer", "Camaro", "Corvette", "Equinox", "Traverse", "Silverado", "Tahoe", "Suburban"],
        chrysler: ["300", "Pacifica", "Voyager"],
        citroen: ["C3", "C4", "C5 Aircross", "Berlingo"],
        cupra: ["Formentor", "Leon", "Born"],
        daihatsu: ["Terios", "Mira"],
        dodge: ["Challenger", "Charger", "Durango", "Ram"],
        ds: ["DS3", "DS4", "DS7 Crossback"],
        ferrari: ["488", "812 Superfast", "Portofino", "Roma", "SF90"],
        fiat: ["500", "Panda", "Tipo"],
        fisker: ["Ocean"],
        ford: ["Bronco", "Escape", "Explorer", "F-150", "Mustang", "Ranger"],
        geely: ["Coolray", "Emgrand", "Azkarra", "Tugella"],
        genesis: ["G70", "G80", "GV70", "GV80"],
        gmc: ["Acadia", "Sierra", "Yukon", "Terrain"],
        haval: ["H6", "H9", "Jolion"],
        hino: ["300", "500", "700", "Dutro", "XZU", "FG", "FL", "FM", "GH", "SH"],
        honda: ["Brio", "City", "Civic", "Accord", "CR-V", "HR-V", "BR-V", "Pilot", "Odyssey", "Jazz"],
        hummer: ["H2", "H3", "EV"],
        hyundai: ["Grand i10", "Accent", "Elantra", "Sonata", "Azera", "i20", "i30", "Creta", "Kona", "Tucson", "Santa Fe", "Palisade", "Stargazer", "Custin", "Staria", "Solati", "County", "Mighty", "Porter H150", "Universe", "Ioniq 5", "Ioniq 6", "Kona Electric"],
        infiniti: ["Q30", "Q50", "Q60", "QX30", "QX50", "QX55", "QX60", "QX70", "QX80"],
        isuzu: ["D-Max", "MU-X", "N-Series", "F-Series", "Q-Series", "EXZ", "FRR", "FVR", "Giga"],
        jaguar: ["XE", "XF", "XJ", "F-Type", "E-Pace", "F-Pace", "I-Pace"],
        jeep: ["Cherokee", "Compass", "Grand Cherokee", "Wrangler"],
        kia: ["Morning", "Soluto", "Rio", "Cerato", "K3", "K5", "Optima", "Carens", "Rondo", "Seltos", "Sportage", "Sorento", "Carnival", "Sedona", "Soul", "Spectra"],
        lamborghini: ["Aventador", "Huracan", "Urus"],
        land_rover: ["Defender", "Discovery", "Discovery Sport", "Range Rover", "Range Rover Sport", "Range Rover Velar", "Range Rover Evoque"],
        lexus: ["ES", "IS", "GS", "LS", "NX", "RX", "GX", "LX", "UX", "RC", "LC"],
        lincoln: ["Aviator", "Corsair", "Navigator"],
        lotus: ["Emira", "Evora", "Exige"],
        lucid: ["Air"],
        maserati: ["Ghibli", "Levante", "Quattroporte"],
        maybach: ["GLS 600", "S-Class"],
        mazda: ["2", "3", "6", "CX-3", "CX-30", "CX-5", "CX-8", "CX-9", "MX-5", "BT-50"],
        mclaren: ["570S", "720S", "Artura"],
        mercedes_benz: ["A-Class", "B-Class", "C-Class", "E-Class", "S-Class", "CLA", "CLS", "GLA", "GLB", "GLC", "GLE", "GLS", "G-Class", "V-Class", "Maybach"],
        mg: ["ZS", "HS", "MG5", "MG4 EV", "5"],
        mini: ["Cooper", "Countryman", "Clubman"],
        mitsubishi: ["Attrage", "Mirage", "Lancer", "Xpander", "Xpander Cross", "Outlander", "Outlander Sport", "Pajero", "Pajero Sport", "Triton", "Zinger"],
        nissan: ["Almera", "Sunny", "Teana", "Navara", "Terra", "X-Trail", "Juke", "Murano", "Patrol", "Livina"],
        opel: ["Astra", "Corsa", "Mokka"],
        pagani: ["Huayra", "Utopia"],
        peugeot: ["2008", "3008", "5008", "408"],
        porsche: ["911", "Cayenne", "Macan", "Panamera", "Taycan"],
        ram: ["1500", "2500", "3500"],
        renault: ["Captur", "Duster", "Megane", "Talisman"],
        rivian: ["R1S", "R1T"],
        rolls_royce: ["Cullinan", "Ghost", "Phantom"],
        saic: ["Maxus", "Roewe"],
        seat: ["Arona", "Ibiza", "Leon"],
        skoda: ["Kodiaq", "Octavia", "Superb"],
        smart: ["Fortwo", "Forfour"],
        ssangyong: ["Korando", "Rexton", "Tivoli"],
        subaru: ["Ascent", "Forester", "Outback", "WRX"],
        suzuki: ["Ciaz", "Swift", "Ertiga", "XL7", "Vitara", "Carry", "Super Carry Truck", "APV", "Jimny", "500kg", "7chá»—"],
        tesla: ["Model 3", "Model S", "Model X", "Model Y"],
        toyota: ["Vios", "Yaris", "Wigo", "Corolla", "Corolla Altis", "Corolla Cross", "Camry", "Avanza", "Veloz", "Innova", "Innova Cross", "Rush", "Fortuner", "Hilux", "Land Cruiser", "Raize", "RAV4", "Zace"],
        vinfast: ["Fadil", "Lux A2.0", "Lux SA2.0", "VF e34", "VF8", "VF9"],
        volkswagen: ["Golf", "Passat", "Polo", "Tiguan", "Touareg"],
        volvo: ["S60", "S90", "XC40", "XC60", "XC90"],
        daewoo: ["Matiz", "Lacetti", "Gentra", "Nubira", "Lanos", "Magnus", "Tosca"]
      };

      const regexWithYears = /(ac|acura|aeolus|alfa_romeo|alpine|aston_martin|audi|bac|bahman|baic|bentley|bmw|bollinger|brilliance|bugatti|buick|byd|cadillac|callaway|carver|chery|chevrolet|chrysler|citroen|cupra|daihatsu|dodge|ds|ferrari|fiat|fisker|ford|geely|genesis|gmc|haval|hino|honda|hummer|hyundai|infiniti|isuzu|jaguar|jeep|kia|lamborghini|land_rover|lexus|lincoln|lotus|lucid|maserati|maybach|mazda|mclaren|mercedes_benz|mg|mini|mitsubishi|nissan|opel|pagani|peugeot|porsche|ram|renault|rivian|rolls_royce|saic|seat|skoda|smart|ssangyong|subaru|suzuki|tesla|toyota|vinfast|volkswagen|volvo|daewoo)(?:[\s-]+([a-zA-Z0-9\s]+?))?(?:[\s-]*(\d{4})(?:[\s-]*(\d{4}))?)?$/i;
      const match = ten.match(regexWithYears);
      if (match) {
        const hang = match[1].replace('_', '-').split('-').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
        const dong = match[2] ? match[2].trim().split(' ').map(w => w.charAt(0).toUpperCase() + w.slice(1).toLowerCase()).join(' ') : '';
        const nam1 = match[3] || '';
        const nam2 = match[4] || '';

        if (nam1 && nam2) {
          const list = [];
          for (let y = parseInt(nam1); y <= parseInt(nam2); y++) {
            list.push(`${hang} ${dong} ${y}`);
          }
          return `<h3>PhÃ¹ há»£p vá»›i cÃ¡c dÃ²ng xe:</h3><p>${list.join(', ')}</p>`;
        } else if (nam1) {
          return `<h3>PhÃ¹ há»£p vá»›i cÃ¡c dÃ²ng xe:</h3><p>${hang} ${dong} ${nam1}</p>`;
        } else {
          return `<h3>PhÃ¹ há»£p vá»›i cÃ¡c dÃ²ng xe:</h3><p>${dong ? `${hang} ${dong}` : hang}</p>`;
        }
      }

      const hangOnly = Object.keys(hangXeMap).find(h => ten.includes(h));
      if (hangOnly) {
        const dongXeList = hangXeMap[hangOnly].slice().sort((a, b) => b.length - a.length);
        const dongXe = dongXeList.find(dong => {
          const pattern = dong.toLowerCase().replace(/\s+/g, '\\s+');
          const regex = new RegExp(pattern, 'i');
          return regex.test(ten);
        });

        const hangUc = hangOnly.replace('_', '-').split('-').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');

        if (dongXe) {
          const matchedDong = ten.match(new RegExp(dongXe.toLowerCase().replace(/\s+/g, '\\s*'), 'i'));
          const finalDong = matchedDong
            ? matchedDong[0].split(' ').map(w => w.charAt(0).toUpperCase() + w.slice(1).toLowerCase()).join(' ')
            : dongXe;
          return `<h3>PhÃ¹ há»£p vá»›i cÃ¡c dÃ²ng xe:</h3><p>${hangUc} ${finalDong}</p>`;
        }

        return `<h3>PhÃ¹ há»£p vá»›i cÃ¡c dÃ²ng xe:</h3><p>${hangUc}</p>`;
      }

      return `<h3>PhÃ¹ há»£p vá»›i cÃ¡c dÃ²ng xe:</h3><p>TÆ°Æ¡ng thÃ­ch vá»›i cÃ¡c dÃ²ng xe thuá»™c thÆ°Æ¡ng hiá»‡u ${thuonghieu}</p>`;
    }
    function kgGuardCopy(copyButton, opts = {}) {
  const { silent = false, threshold = 0.65 } = opts;

  const website = copyButton.dataset.website || document.getElementById('website').value;

  const ten = (document.getElementById('ten')?.value || '').trim();
  const ma  = (document.getElementById('ma')?.value || '').trim();
  const pkey = copyButton.dataset.productKey || kgMakeProductKey(ten, ma);

  const descRaw = copyButton.dataset.descHtml || '';
  if (!pkey || !descRaw) {
    copyButton.style.display = 'block';
    return { guarded: false };
  }

  if (!KG_TRACK_SITES.has(website)) {
    copyButton.style.display = 'block';
    return { guarded: false };
  }

  const dup = kgIsDuplicateDesc(pkey, website, descRaw, threshold);

  if (dup.duplicate) {
    copyButton.style.display = 'none';
    if (!silent) {
      alert(`âŒ MÃ´ táº£ trÃ¹ng/gáº§n trÃ¹ng (${Math.round(dup.similarity * 100)}%) vá»›i web "${dup.conflictSite}".\nKhÃ´ng cho copy. Báº¥m "Táº¡o ná»™i dung" láº¡i Ä‘á»ƒ ra mÃ´ táº£ khÃ¡c.`);
    }
    return { guarded: true, dup };
  }

  copyButton.style.display = 'block';
  return { guarded: false };
}

    function taoNoiDung() {
  const ten = document.getElementById('ten').value.trim();
  const ma = document.getElementById('ma').value.trim();
  const thuonghieu = document.getElementById('thuonghieu').value.trim();
  const xuatxu = document.getElementById('xuatxu').value.trim();
  const website = document.getElementById('website').value;

  if (!ten || !ma || !thuonghieu || !xuatxu) {
    alert("Vui lÃ²ng nháº­p Ä‘áº§y Ä‘á»§ thÃ´ng tin!");
    return;
  }

  // Parse nÄƒm linh hoáº¡t tá»« cuá»‘i chuá»—i (báº¯t 2015-2017 hoáº·c 2015)
  const yearRegex = /(\d{4})(?:\D+(\d{4}))?$/i;
  const yearMatch = ten.match(yearRegex);

  let tenPhuTung = ten.trim();
  let dateText = ''; // " 2015â€“2017" hoáº·c " 2015"
  let nam1 = '';
  let nam2 = '';

  if (yearMatch) {
    nam1 = yearMatch[1];
    nam2 = yearMatch[2] || '';
    dateText = nam2 ? ` ${nam1}â€“${nam2}` : ` ${nam1}`;
    // Cáº¯t bá» pháº§n nÄƒm khá»i tenPhuTung Ä‘á»ƒ tÃªn sáº¡ch
    tenPhuTung = ten.replace(yearRegex, '').trim().replace(/\s+$/, '');
  }

  // Parse hÃ£ng xe vÃ  dÃ²ng xe (regex cÅ©, nhÆ°ng giá» optional)
  const regex = /(.*?)(ac|acura|aeolus|alfa_romeo|alpine|aston_martin|audi|bac|bahman|baic|bentley|bmw|bollinger|brilliance|bugatti|buick|byd|cadillac|callaway|carver|chery|chevrolet|chrysler|citroen|cupra|daihatsu|dodge|ds|ferrari|fiat|fisker|ford|geely|genesis|gmc|haval|hino|honda|hummer|hyundai|infiniti|isuzu|jaguar|jeep|kia|lamborghini|land_rover|lexus|lincoln|lotus|lucid|maserati|maybach|mazda|mclaren|mercedes_benz|mg|mini|mitsubishi|nissan|opel|pagani|peugeot|porsche|ram|renault|rivian|rolls_royce|saic|seat|skoda|smart|ssangyong|subaru|suzuki|tesla|toyota|vinfast|volkswagen|volvo|daewoo|mercedes)[\s-]+([a-zA-Z0-9\s.]+)/i;
  const match = tenPhuTung.match(regex);

  let hang = thuonghieu || ''; // Æ¯u tiÃªn input thÆ°Æ¡ng hiá»‡u
  let dong = '';

  if (match) {
    hang = match[2].replace('_', '-').split('-').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
    dong = match[3].trim();
  } else {
    // Náº¿u khÃ´ng match hÃ£ng, dÃ¹ng input thÆ°Æ¡ng hiá»‡u
    hang = thuonghieu;
    dong = tenPhuTung.replace(hang, '').trim(); // ÄoÃ¡n dong tá»« tÃªn
  }

  // Variation H1 theo yÃªu cáº§u cuá»‘i cÃ¹ng cá»§a mÃ y
  let h1Text = ten; // Default náº¿u khÃ´ng parse Ä‘Æ°á»£c
  if (website === 'kieugiaauto') {
    h1Text = tenPhuTung.trim(); // Bá» nÄƒm cho web chÃ­nh
  } else if (website === 'phutunggiare') {
    h1Text = `${tenPhuTung} mÃ£ ${ma}`.trim(); // Phá»¥ 1: thÃªm mÃ£ tá»« input "ma"
  } else if (website === 'banphutung') {
    h1Text = `${tenPhuTung} giÃ¡ tá»‘t`.trim(); // Phá»¥ 2: "giÃ¡ tá»‘t"
  } else if (website === 'phutungotokieugia') {
    h1Text = `${tenPhuTung}${dateText}`.trim(); // Phá»¥ 3: giá»¯ nÄƒm
  } else if (website === 'shopee') {
    h1Text = ten; // Giá»¯ nguyÃªn cho Shopee
  }

  const moTaTuDong = sinhMoTaTuDong(ten);
 // ===== STEP #2: nhá»› mÃ´ táº£ auto Ä‘á»ƒ cháº·n trÃ¹ng khi COPY =====
window.__kg_last_auto_desc = {
  productKey: kgMakeProductKey(ten, ma),
  website,
  descHtml: moTaTuDong
};
  const danhSachXe = sinhDanhSachXe(ten, thuonghieu, website === 'shopee');

  const hangXeList = [
    'Toyota', 'Kia', 'Mazda', 'Ford', 'Honda', 'Hyundai', 'Mitsubishi', 'Nissan', 'Suzuki', 'Chevrolet',
    'Isuzu', 'Daewoo', 'Lexus', 'BMW', 'Mercedes-Benz', 'Audi', 'VinFast', 'Hino', 'Thaco', 'Fiat',
    'Jac', 'Kenbo', 'Veam', 'Dongben', 'SYM', 'Haima', 'Chery', 'Renault', 'Daihatsu', 'Bentley',
    'Range Rover', 'Vinasuki'
  ];

  let hangXeLinks = {};
  switch (website) {
    case 'banphutung':
      hangXeLinks = Object.fromEntries(hangXeList.map(hang => [hang, `https://banphutungoto.vn/${hang.toLowerCase().replace(' ', '-')}`]));
      break;
    case 'phutunggiare':
      hangXeLinks = Object.fromEntries(hangXeList.map(hang => [hang, `https://phutunggiare.vn/phu-tung-${hang.toLowerCase().replace(' ', '-')}`]));
      break;
    case 'phutungotokieugia':
      hangXeLinks = Object.fromEntries(hangXeList.map(hang => [hang, `https://phutungotokieugia.vn/${hang.toLowerCase().replace(' ', '-')}`]));
      break;
    case 'kieugiaauto':
      hangXeLinks = Object.fromEntries(hangXeList.map(hang => [hang, `https://kieugiaauto.vn/${hang.toLowerCase().replace(' ', '-')}`]));
      break;
    default:
      hangXeLinks = {};
  }

  const brandsToLink = [
    'Audi', 'Nissan', 'Kia', 'Daewoo', 'Mazda', 'Ford', 'Toyota', 'Lexus', 'Isuzu', 'Chevrolet',
    'Hyundai', 'Honda', 'Mitsubishi', 'Suzuki', 'Renault', 'Daihatsu', 'Chery', 'BMW', 'Vinasuki',
    'Mercedes-Benz', 'Thaco', 'Fiat', 'Range Rover', 'Bentley'
  ];

      let content = '';
      let copyContent = '';
/* =========================
 * WEB CHÃNH â€“ kieugiaauto
 * ========================= */
 if (website === 'kieugiaauto') {
  content = `<h2><strong>${h1Text}</strong></h2>
<p><strong>MÃ£ sáº£n pháº©m:</strong> ${ma}</p>
<p><strong>ThÆ°Æ¡ng hiá»‡u:</strong> ${thuonghieu}</p>
<p><strong>Xuáº¥t xá»©:</strong> ${xuatxu}</p>
${moTaTuDong}

<p>
<strong>${h1Text}</strong> lÃ  phá»¥ tÃ¹ng cÃ³ vai trÃ² há»— trá»£ duy trÃ¬ tráº¡ng thÃ¡i váº­n hÃ nh á»•n Ä‘á»‹nh cá»§a xe, gÃ³p pháº§n Ä‘áº£m báº£o kháº£ nÄƒng sá»­ dá»¥ng an toÃ n vÃ  bá»n bá»‰ theo thá»i gian.
</p>

<h3>Khi nÃ o nÃªn kiá»ƒm tra vÃ  thay tháº¿ phá»¥ tÃ¹ng?</h3>
<p>
Trong quÃ¡ trÃ¬nh sá»­ dá»¥ng, phá»¥ tÃ¹ng cÃ³ thá»ƒ bá»‹ hao mÃ²n theo thá»i gian hoáº·c chá»‹u tÃ¡c Ä‘á»™ng tá»« Ä‘iá»u kiá»‡n váº­n hÃ nh thá»±c táº¿. Khi xe xuáº¥t hiá»‡n cÃ¡c dáº¥u hiá»‡u báº¥t thÆ°á»ng nhÆ° rung láº¯c, phÃ¡t sinh tiáº¿ng á»“n hoáº·c kháº£ nÄƒng váº­n hÃ nh khÃ´ng cÃ²n á»•n Ä‘á»‹nh, ngÆ°á»i dÃ¹ng nÃªn kiá»ƒm tra vÃ  cÃ¢n nháº¯c thay tháº¿ ká»‹p thá»i.
</p>

<h3>Táº§m quan trá»ng cá»§a viá»‡c lá»±a chá»n Ä‘Ãºng mÃ£ vÃ  nguá»“n cung uy tÃ­n</h3>
<p>
Viá»‡c sá»­ dá»¥ng Ä‘Ãºng mÃ£ phá»¥ tÃ¹ng theo Ä‘á»i xe giÃºp Ä‘áº£m báº£o láº¯p rÃ¡p chÃ­nh xÃ¡c, háº¡n cháº¿ sai lá»‡ch ká»¹ thuáº­t vÃ  trÃ¡nh áº£nh hÆ°á»Ÿng Ä‘áº¿n cÃ¡c bá»™ pháº­n liÃªn quan. NgÆ°á»£c láº¡i, lá»±a chá»n sai mÃ£ hoáº·c sáº£n pháº©m khÃ´ng rÃµ nguá»“n gá»‘c cÃ³ thá»ƒ lÃ m giáº£m tuá»•i thá» há»‡ thá»‘ng vÃ  phÃ¡t sinh chi phÃ­ sá»­a chá»¯a khÃ´ng cáº§n thiáº¿t.
</p>

<h3>Vai trÃ² cá»§a Kiá»u Gia Auto trong tÆ° váº¥n vÃ  cung á»©ng phá»¥ tÃ¹ng</h3>
<p>
Kiá»u Gia Auto táº­p trung vÃ o viá»‡c cung cáº¥p phá»¥ tÃ¹ng cÃ³ nguá»“n gá»‘c rÃµ rÃ ng, Ä‘á»“ng thá»i há»— trá»£ kiá»ƒm tra mÃ£ vÃ  tÆ° váº¥n ká»¹ thuáº­t nháº±m giÃºp khÃ¡ch hÃ ng lá»±a chá»n Ä‘Ãºng sáº£n pháº©m phÃ¹ há»£p vá»›i tá»«ng dÃ²ng xe vÃ  nhu cáº§u sá»­ dá»¥ng.
</p>

<h3>Nhá»¯ng giÃ¡ trá»‹ khÃ¡ch hÃ ng nháº­n Ä‘Æ°á»£c</h3>
<ul>
  <li>Äá»‘i chiáº¿u chÃ­nh xÃ¡c mÃ£ phá»¥ tÃ¹ng theo Ä‘á»i xe</li>
  <li>Sáº£n pháº©m Ä‘Æ°á»£c kiá»ƒm tra trÆ°á»›c khi xuáº¥t kho</li>
  <li>Há»— trá»£ tÆ° váº¥n ká»¹ thuáº­t rÃµ rÃ ng, dá»… hiá»ƒu</li>
  <li>Äáº£m báº£o tÃ­nh tÆ°Æ¡ng thÃ­ch vÃ  Ä‘á»™ bá»n khi sá»­ dá»¥ng</li>
</ul>

<h4>ChÃ­nh sÃ¡ch há»— trá»£ khÃ¡ch hÃ ng</h4>
<ul>
  <li>Äá»•i tráº£ trong 7 ngÃ y náº¿u sáº£n pháº©m chÆ°a láº¯p rÃ¡p vÃ  cÃ²n nguyÃªn váº¹n</li>
  <li>Báº£o hÃ nh theo Ä‘Ãºng quy Ä‘á»‹nh cá»§a nhÃ  sáº£n xuáº¥t</li>
</ul>

<p>
ğŸ“ <strong>Trá»¥ sá»Ÿ:</strong> NgÃµ 84 Kim NgÆ°u, Hai BÃ  TrÆ°ng, HÃ  Ná»™i<br>
ğŸ“ <strong>LiÃªn há»‡ tÆ° váº¥n:</strong> 0914.153.555 â€“ 0924.153.555 â€“ 0898.153.555 â€“ 0378.05.6666
</p>`;
  copyContent = content;

/* =========================
 * WEB PHá»¤ 1 â€“ theo MÃƒ
 * ========================= */
} else if (website === 'phutungotokieugia') {
  content = `<h2>âœ”ï¸ ${h1Text}</h2>
<p><strong>MÃ£ sáº£n pháº©m:</strong> ${ma}</p>
<p><strong>ThÆ°Æ¡ng hiá»‡u:</strong> ${thuonghieu}</p>
<p><strong>Xuáº¥t xá»©:</strong> ${xuatxu}</p>
${moTaTuDong}

<p>
<strong>${h1Text}</strong> lÃ  phá»¥ tÃ¹ng Ä‘Æ°á»£c sáº£n xuáº¥t theo mÃ£ vÃ  thÃ´ng sá»‘ ká»¹ thuáº­t cá»¥ thá»ƒ, nháº±m Ä‘áº£m báº£o kháº£ nÄƒng láº¯p Ä‘áº·t chÃ­nh xÃ¡c cho Ä‘Ãºng Ä‘á»i xe vÃ  cáº¥u hÃ¬nh tÆ°Æ¡ng á»©ng.
</p>

<h3>VÃ¬ sao cáº§n kiá»ƒm tra Ä‘Ãºng mÃ£ trÆ°á»›c khi láº¯p Ä‘áº·t?</h3>
<p>
Má»—i mÃ£ phá»¥ tÃ¹ng Ä‘Æ°á»£c thiáº¿t káº¿ cho má»™t nhÃ³m xe hoáº·c Ä‘á»i xe nháº¥t Ä‘á»‹nh. Viá»‡c sá»­ dá»¥ng sai mÃ£ cÃ³ thá»ƒ dáº«n Ä‘áº¿n khÃ´ng tÆ°Æ¡ng thÃ­ch, láº¯p Ä‘áº·t khÃ´ng Ä‘Ãºng ká»¹ thuáº­t hoáº·c áº£nh hÆ°á»Ÿng Ä‘áº¿n kháº£ nÄƒng váº­n hÃ nh cá»§a há»‡ thá»‘ng liÃªn quan.
</p>

<h3>Nhá»¯ng Ä‘iá»ƒm cáº§n Ä‘á»‘i chiáº¿u khi chá»n mÃ£</h3>
<ul>
  <li>ÄÃºng mÃ£ phá»¥ tÃ¹ng theo Ä‘á»i xe vÃ  phiÃªn báº£n</li>
  <li>PhÃ¹ há»£p vá»›i cáº¥u hÃ¬nh vÃ  há»‡ thá»‘ng Ä‘ang sá»­ dá»¥ng</li>
  <li>KhÃ´ng thay tháº¿ cho cÃ¡c mÃ£ cÃ³ thÃ´ng sá»‘ khÃ¡c</li>
</ul>

<p>
<strong>Khuyáº¿n nghá»‹:</strong> TrÆ°á»›c khi Ä‘áº·t hÃ ng, ngÆ°á»i dÃ¹ng nÃªn cung cáº¥p Ä‘áº§y Ä‘á»§ thÃ´ng tin xe hoáº·c Ä‘á»‘i chiáº¿u mÃ£ trá»±c tiáº¿p Ä‘á»ƒ Ä‘áº£m báº£o lá»±a chá»n Ä‘Ãºng sáº£n pháº©m cáº§n sá»­ dá»¥ng.
</p>

<h4>ChÃ­nh sÃ¡ch báº£o hÃ nh & Ä‘á»•i tráº£</h4>
<ul>
  <li>Äá»•i tráº£ trong 7 ngÃ y náº¿u sáº£n pháº©m chÆ°a láº¯p rÃ¡p vÃ  cÃ²n nguyÃªn váº¹n</li>
  <li>Báº£o hÃ nh theo tiÃªu chuáº©n cá»§a nhÃ  sáº£n xuáº¥t</li>
</ul>

<p>
ğŸ“ <strong>Kho phá»¥ tÃ¹ng:</strong> Sá»‘ 84 NgÃµ Kim NgÆ°u, Hai BÃ  TrÆ°ng, HÃ  Ná»™i<br>
ğŸ“ <strong>Há»— trá»£ kiá»ƒm tra mÃ£ & Ä‘áº·t hÃ ng:</strong> 0924.153.555 â€“ 0914.153.555 â€“ 0898.153.555 â€“ 0378.05.6666
</p>`;
  copyContent = content;

/* =========================
 * WEB PHá»¤ 3 â€“ Ká»¸ THUáº¬T / GARA
 * ========================= */
} else if (website === 'banphutung') {
  content = `<h2><strong>${h1Text}</strong></h2>
<p><strong>MÃ£ sáº£n pháº©m:</strong> ${ma}</p>
<p><strong>ThÆ°Æ¡ng hiá»‡u:</strong> ${thuonghieu}</p>
<p><strong>Xuáº¥t xá»©:</strong> ${xuatxu}</p>

${moTaTuDong}

<p>
<strong>${h1Text}</strong> lÃ  phá»¥ tÃ¹ng phÃ¹ há»£p cho cÃ¡c gara vÃ  Ä‘Æ¡n vá»‹ sá»­a chá»¯a cáº§n nguá»“n hÃ ng á»•n Ä‘á»‹nh, thay tháº¿ nhanh vÃ  Ä‘áº£m báº£o Ä‘Ãºng chá»§ng loáº¡i trong quÃ¡ trÃ¬nh váº­n hÃ nh dá»‹ch vá»¥.
</p>

<h3>Giáº£i phÃ¡p cung á»©ng cho gara vÃ  Ä‘á»‘i tÃ¡c sá»­a chá»¯a</h3>
<p>
Kiá»u Gia Auto táº­p trung vÃ o kháº£ nÄƒng cung á»©ng liÃªn tá»¥c, há»— trá»£ bÃ¡o giÃ¡ nhanh vÃ  giao hÃ ng Ä‘Ãºng tiáº¿n Ä‘á»™ nháº±m giÃºp gara duy trÃ¬ hoáº¡t Ä‘á»™ng sá»­a chá»¯a khÃ´ng giÃ¡n Ä‘oáº¡n.
</p>

<ul>
  <li>HÃ ng sáºµn kho, chá»§ Ä‘á»™ng nguá»“n cung</li>
  <li>Há»— trá»£ Ä‘Æ¡n sá»‘ lÆ°á»£ng lá»›n cho gara</li>
  <li>ÄÃ³ng gÃ³i ká»¹, giao hÃ ng toÃ n quá»‘c</li>
</ul>

<h4>ChÃ­nh sÃ¡ch dÃ nh cho Ä‘á»‘i tÃ¡c</h4>
<ul>
  <li>Äá»•i tráº£ trong 7 ngÃ y vá»›i sáº£n pháº©m chÆ°a láº¯p rÃ¡p hoáº·c lá»—i tá»« nhÃ  sáº£n xuáº¥t</li>
  <li>Há»— trá»£ Ä‘á»‘i chiáº¿u mÃ£ vÃ  thÃ´ng tin sáº£n pháº©m khi cáº§n</li>
</ul>

<p>
ğŸ“ <strong>Kho hÃ ng:</strong> 84 Kim NgÆ°u, Hai BÃ  TrÆ°ng, HÃ  Ná»™i<br>
ğŸ“ <strong>LiÃªn há»‡ bÃ¡o giÃ¡ & Ä‘áº·t hÃ ng sá»‰:</strong> 0898.153.555 â€“ 0914.153.555 â€“ 0378.05.6666
</p>

<p><strong>Sáº£n pháº©m liÃªn quan:</strong></p>`;
  copyContent = content;

/* =========================
 * WEB PHá»¤ 2 â€“ GIÃ Ráºº / BÃN NHANH
 * ========================= */
} else if (website === 'phutunggiare') {
  content = `<h2><strong>${h1Text}</strong></h2>
<p><strong>MÃ£ sáº£n pháº©m:</strong> ${ma}</p>
<p><strong>ThÆ°Æ¡ng hiá»‡u:</strong> ${thuonghieu}</p>
<p><strong>Xuáº¥t xá»©:</strong> ${xuatxu}</p>

${moTaTuDong}

<p>
<strong>${h1Text}</strong> lÃ  lá»±a chá»n phÃ¹ há»£p cho nhu cáº§u thay tháº¿ nhanh, Æ°u tiÃªn chi phÃ­ há»£p lÃ½ vÃ  kháº£ nÄƒng sá»­ dá»¥ng á»•n Ä‘á»‹nh trong thá»±c táº¿.
</p>

<h3>Mua nhanh â€“ Ä‘Ãºng mÃ£ â€“ dá»… sá»­ dá»¥ng</h3>
<p>
Sáº£n pháº©m Ä‘Æ°á»£c kiá»ƒm tra trÆ°á»›c khi giao, giÃºp háº¡n cháº¿ nháº§m mÃ£ vÃ  rÃºt ngáº¯n thá»i gian sá»­a chá»¯a hoáº·c thay tháº¿.
</p>

<ul>
  <li>GiÃ¡ bÃ¡n cáº¡nh tranh, tá»‘i Æ°u chi phÃ­</li>
  <li>HÃ ng Ä‘Ãºng mÃ£ theo thÃ´ng tin Ä‘Ã£ xÃ¡c nháº­n</li>
  <li>Giao hÃ ng nhanh, há»— trá»£ COD toÃ n quá»‘c</li>
</ul>

<h4>Cam káº¿t khi mua hÃ ng</h4>
<ul>
  <li>Äá»•i tráº£ trong 7 ngÃ y náº¿u sáº£n pháº©m chÆ°a láº¯p rÃ¡p vÃ  cÃ²n nguyÃªn váº¹n</li>
  <li>Há»— trá»£ kiá»ƒm tra mÃ£ trÆ°á»›c khi xÃ¡c nháº­n Ä‘Æ¡n</li>
</ul>

<p>
ğŸ“ <strong>Kho hÃ ng:</strong> Kiá»u Gia Auto â€“ NgÃµ 84 Kim NgÆ°u, HÃ  Ná»™i<br>
ğŸ“ <strong>Hotline Ä‘áº·t hÃ ng nhanh:</strong> 0378.05.6666 â€“ 0914.153.555 â€“ 0924.153.555
</p>`;
        copyContent = content;
      } else if (website === 'shopee') {
        content = `<h2><strong>${ten}</strong></h2>
<p><strong>MÃ£ sáº£n pháº©m:</strong> ${ma}</p>
<p><strong>ThÆ°Æ¡ng hiá»‡u:</strong> ${thuonghieu}</p>
<p><strong>Xuáº¥t xá»©:</strong> ${xuatxu}</p>
${moTaTuDong}
${danhSachXe}
<h3>âœ”ï¸ Kiá»u Gia Auto - Phá»¥ tÃ¹ng Ã´ tÃ´ chÃ­nh hÃ£ng, giÃ¡ tá»‘t nháº¥t</h3>
<ul>
  <li>Cung cáº¥p â€œ${ten}â€ cháº¥t lÆ°á»£ng vÆ°á»£t trá»™i, giÃ¡ cáº£ cáº¡nh tranh.</li>
  <li>KhuyÃªn dÃ¹ng phá»¥ tÃ¹ng cÃ³ nguá»“n gá»‘c rÃµ rÃ ng Ä‘á»ƒ Ä‘áº£m báº£o hiá»‡u suáº¥t vÃ  Ä‘á»™ bá»n.</li>
  <li>Nháº­p kháº©u vÃ  phÃ¢n phá»‘i phá»¥ tÃ¹ng chÃ­nh hÃ£ng tá»›i nhiá»u gara trÃªn toÃ n quá»‘c.</li>
  <li>Äá»™i ngÅ© nhÃ¢n viÃªn am hiá»ƒu ká»¹ thuáº­t, tÆ° váº¥n táº­n tÃ¢m, chuyÃªn nghiá»‡p.</li>
</ul>
<h3>âœ”ï¸ ChÃ­nh sÃ¡ch báº£o hÃ nh:</h3>
<ul>
  <li>Báº£o hÃ nh 1 Ä‘á»•i 1 trong 7 ngÃ y náº¿u phÃ¡t hiá»‡n lá»—i tá»« nhÃ  sáº£n xuáº¥t.</li>
  <li>Sáº£n pháº©m Ä‘Æ°á»£c Ä‘á»•i tráº£ trong vÃ²ng 7 ngÃ y, vá»›i Ä‘iá»u kiá»‡n cÃ²n nguyÃªn váº¹n, chÆ°a láº¯p rÃ¡p, khÃ´ng tráº§y xÆ°á»›c, cÃ²n nguyÃªn bao bÃ¬.</li>
</ul>
<h3>âœ”ï¸ LÆ°u Ã½:</h3>
<ul>
  <li>Khi má»Ÿ sáº£n pháº©m, vui lÃ²ng quay video Ä‘á»ƒ Ä‘áº£m báº£o quyá»n lá»£i Ä‘á»•i tráº£ náº¿u cÃ³ lá»—i tá»« nhÃ  cung cáº¥p.</li>
  <li>QuÃ½ khÃ¡ch vui lÃ²ng Ä‘Ã¡nh giÃ¡ sáº£n pháº©m Ä‘á»ƒ nháº­n thÃªm Æ°u Ä‘Ã£i tá»« shop!</li>
</ul>
<h3>âœ”ï¸ Cam káº¿t cá»§a Kiá»u Gia Auto:</h3>
<ul>
  <li>Äá»™i ngÅ© tÆ° váº¥n chuyÃªn nghiá»‡p, mang Ä‘áº¿n tráº£i nghiá»‡m tuyá»‡t vá»i cho khÃ¡ch hÃ ng.</li>
  <li>HoÃ n tiá»n hoáº·c Ä‘á»•i sáº£n pháº©m má»›i náº¿u quÃ½ khÃ¡ch khÃ´ng hÃ i lÃ²ng vÃ¬ lá»—i sáº£n pháº©m.</li>
  <li>ThÆ°Æ¡ng hiá»‡u uy tÃ­n, Ä‘Ã¡ng tin cáº­y.</li>
</ul>
<h3>âœ”ï¸ Äáº£m báº£o tá»« Kiá»u Gia Auto:</h3>
<ul>
  <li>HÃ¬nh áº£nh â€œ${ten}â€ Ä‘Ãºng 100% vá»›i thá»±c táº¿.</li>
  <li>Cháº¥t lÆ°á»£ng sáº£n pháº©m Ä‘áº£m báº£o tuyá»‡t Ä‘á»‘i.</li>
  <li>Há»— trá»£ Ä‘á»•i tráº£ theo chÃ­nh sÃ¡ch quy Ä‘á»‹nh.</li>
  <li>Giao hÃ ng nhanh chÃ³ng trÃªn toÃ n quá»‘c.</li>
</ul>
<p>ChÃ¢n thÃ nh cáº£m Æ¡n quÃ½ khÃ¡ch Ä‘Ã£ tin tÆ°á»Ÿng vÃ  Ä‘á»“ng hÃ nh cÃ¹ng Kiá»u Gia Auto!</p>`;
        
        // Chuyá»ƒn ná»™i dung HTML sang plain text, nhÆ°ng giá»¯ Ä‘á»‹nh dáº¡ng in Ä‘áº­m
        let plainMoTaTuDong = moTaTuDong
          .replace(/<strong>(.*?)<\/strong>/g, '**$1**') // Chuyá»ƒn <strong> thÃ nh **text**
          .replace(/<[^>]+>/g, ''); // Loáº¡i bá» cÃ¡c tháº» HTML khÃ¡c
        let plainDanhSachXe = danhSachXe
          .replace(/<strong>(.*?)<\/strong>/g, '**$1**')
          .replace(/<[^>]+>/g, '');

        copyContent = `**${ten}**\nMÃ£ sáº£n pháº©m: ${ma}\nThÆ°Æ¡ng hiá»‡u: ${thuonghieu}\nXuáº¥t xá»©: ${xuatxu}\n\n${plainMoTaTuDong}\n\n${plainDanhSachXe}\n\n**Kiá»u Gia Auto - Phá»¥ tÃ¹ng Ã´ tÃ´ chÃ­nh hÃ£ng, giÃ¡ tá»‘t nháº¥t**\n- Cung cáº¥p â€œ${ten}â€ cháº¥t lÆ°á»£ng vÆ°á»£t trá»™i, giÃ¡ cáº£ cáº¡nh tranh.\n- KhuyÃªn dÃ¹ng phá»¥ tÃ¹ng cÃ³ nguá»“n gá»‘c rÃµ rÃ ng Ä‘á»ƒ Ä‘áº£m báº£o hiá»‡u suáº¥t vÃ  Ä‘á»™ bá»n.\n- Nháº­p kháº©u vÃ  phÃ¢n phá»‘i phá»¥ tÃ¹ng chÃ­nh hÃ£ng tá»›i nhiá»u gara trÃªn toÃ n quá»‘c.\n- Äá»™i ngÅ© nhÃ¢n viÃªn am hiá»ƒu ká»¹ thuáº­t, tÆ° váº¥n táº­n tÃ¢m, chuyÃªn nghiá»‡p.\n\n**ChÃ­nh sÃ¡ch báº£o hÃ nh:**\n- Báº£o hÃ nh 1 Ä‘á»•i 1 trong 7 ngÃ y náº¿u phÃ¡t hiá»‡n lá»—i tá»« nhÃ  sáº£n xuáº¥t.\n- Sáº£n pháº©m Ä‘Æ°á»£c Ä‘á»•i tráº£ trong vÃ²ng 7 ngÃ y, vá»›i Ä‘iá»u kiá»‡n cÃ²n nguyÃªn váº¹n, chÆ°a láº¯p rÃ¡p, khÃ´ng tráº§y xÆ°á»›c, cÃ²n nguyÃªn bao bÃ¬.\n\n**LÆ°u Ã½:**\n- Khi má»Ÿ sáº£n pháº©m, vui lÃ²ng quay video Ä‘á»ƒ Ä‘áº£m báº£o quyá»n lá»£i Ä‘á»•i tráº£ náº¿u cÃ³ lá»—i tá»« nhÃ  cung cáº¥p.\n- QuÃ½ khÃ¡ch vui lÃ²ng Ä‘Ã¡nh giÃ¡ sáº£n pháº©m Ä‘á»ƒ nháº­n thÃªm Æ°u Ä‘Ã£i tá»« shop!\n\n**Cam káº¿t cá»§a Kiá»u Gia Auto:**\n- Äá»™i ngÅ© tÆ° váº¥n chuyÃªn nghiá»‡p, mang Ä‘áº¿n tráº£i nghiá»‡m tuyá»‡t vá»i cho khÃ¡ch hÃ ng.\n- HoÃ n tiá»n hoáº·c Ä‘á»•i sáº£n pháº©m má»›i náº¿u quÃ½ khÃ¡ch khÃ´ng hÃ i lÃ²ng vÃ¬ lá»—i sáº£n pháº©m.\n- ThÆ°Æ¡ng hiá»‡u uy tÃ­n, Ä‘Ã¡ng tin cáº­y.\n\n**Äáº£m báº£o tá»« Kiá»u Gia Auto:**\n- HÃ¬nh áº£nh â€œ${ten}â€ Ä‘Ãºng 100% vá»›i thá»±c táº¿.\n- Cháº¥t lÆ°á»£ng sáº£n pháº©m Ä‘áº£m báº£o tuyá»‡t Ä‘á»‘i.\n- Há»— trá»£ Ä‘á»•i tráº£ theo chÃ­nh sÃ¡ch quy Ä‘á»‹nh.\n- Giao hÃ ng nhanh chÃ³ng trÃªn toÃ n quá»‘c.\n\nChÃ¢n thÃ nh cáº£m Æ¡n quÃ½ khÃ¡ch Ä‘Ã£ tin tÆ°á»Ÿng vÃ  Ä‘á»“ng hÃ nh cÃ¹ng Kiá»u Gia Auto!`;
      }

      content = content.replace(/<li>(.*?)\.\s*<\/li>/g, '<li>$1</li>');
      document.getElementById('preview').innerHTML = content;

      const copyButton = document.getElementById('copyButton');
copyButton.dataset.content = copyContent;

// âœ… Ghim info Ä‘á»ƒ check/commit Ä‘Ãºng "moTaTuDong"
copyButton.dataset.productKey = kgMakeProductKey(ten, ma);
copyButton.dataset.website    = website;
copyButton.dataset.descHtml   = moTaTuDong || '';

// âœ… Guard quyáº¿t Ä‘á»‹nh hiá»‡n/áº©n nÃºt copy (áº©n náº¿u trÃ¹ng vá»›i web khÃ¡c Ä‘Ã£ copy)
kgGuardCopy(copyButton, { silent: true });
}


// =========================
// HÃ m sao chÃ©p ná»™i dung
// =========================
function saoChepNoiDung() {
  const copyButton = document.getElementById('copyButton');

  // âœ… cháº·n copy náº¿u trÃ¹ng
  const g = kgGuardCopy(copyButton, { silent: false });
  if (g.guarded) return;

  const website = copyButton.dataset.website || document.getElementById('website').value;
  let content = copyButton.dataset.content;

  if (!content) {
    alert('ChÆ°a cÃ³ ná»™i dung Ä‘á»ƒ sao chÃ©p! Vui lÃ²ng táº¡o ná»™i dung trÆ°á»›c.');
    return;
  }

  // ===== LÃ m sáº¡ch ná»™i dung =====
  if (website === 'banphutung' || website === 'phutungotokieugia') {
    const parser = new DOMParser();
    const doc = parser.parseFromString(content, 'text/html');

    const removeEmptyNodes = (node) => {
      if (node.nodeType === Node.ELEMENT_NODE) {
        if (['P', 'DIV', 'UL', 'LI'].includes(node.tagName)
          && !node.textContent.trim()
          && !node.querySelector('a, strong, em')) {
          node.remove();
          return;
        }
        Array.from(node.childNodes).forEach(removeEmptyNodes);
      }
    };
    removeEmptyNodes(doc.body);

    content = doc.body.innerHTML.trim()
      .replace(/\n\s*\n/g, '\n')
      .replace(/\s+$/gm, '');

  } else if (website === 'shopee') {
    content = content.trim()
      .replace(/\n\s*\n/g, '\n')
      .replace(/\s+$/gm, '');

  } else {
    const parser = new DOMParser();
    const doc = parser.parseFromString(content, 'text/html');

    const removeEmptyNodes = (node) => {
      if (node.nodeType === Node.ELEMENT_NODE) {
        if (['P', 'DIV', 'UL', 'LI'].includes(node.tagName)
          && !node.textContent.trim()
          && !node.querySelector('a, strong, em')) {
          node.remove();
          return;
        }
        Array.from(node.childNodes).forEach(removeEmptyNodes);
      }
    };
    removeEmptyNodes(doc.body);

    content = doc.body.innerHTML.trim()
      .replace(/\n\s*\n/g, '\n')
      .replace(/\s+$/gm, '');
  }

  // ===== Commit + UI sau copy =====
  const commitAfterCopy = () => {
    if (KG_TRACK_SITES.has(website)) {
      const pkey = copyButton.dataset.productKey;
      const desc = copyButton.dataset.descHtml;
      if (pkey && desc) kgCommitDesc(pkey, website, desc);
    }
    alert('ÄÃ£ sao chÃ©p ná»™i dung thÃ nh cÃ´ng!');
    copyButton.style.display = 'none';
  };

  // ===== Copy =====
  if (navigator.clipboard && window.isSecureContext) {
    navigator.clipboard.writeText(content)
      .then(commitAfterCopy)
      .catch(err => {
        console.error('Lá»—i sao chÃ©p clipboard:', err);
        const ok = fallbackCopy(content);
        if (ok) commitAfterCopy();
      });
  } else {
    const ok = fallbackCopy(content);
    if (ok) commitAfterCopy();
  }
}

// =========================
// PhÆ°Æ¡ng Ã¡n dá»± phÃ²ng Ä‘á»ƒ sao chÃ©p
// =========================
function fallbackCopy(text) {
  const textArea = document.createElement('textarea');
  textArea.value = text;
  textArea.style.position = 'fixed';
  textArea.style.opacity = '0';
  document.body.appendChild(textArea);
  textArea.focus();
  textArea.select();

  try {
    const ok = document.execCommand('copy');
    if (!ok) alert('KhÃ´ng thá»ƒ sao chÃ©p ná»™i dung! Vui lÃ²ng thá»­ láº¡i hoáº·c sao chÃ©p thá»§ cÃ´ng.');
    return ok;
  } catch (err) {
    console.error('Lá»—i sao chÃ©p dá»± phÃ²ng:', err);
    alert('KhÃ´ng thá»ƒ sao chÃ©p ná»™i dung! Vui lÃ²ng thá»­ láº¡i hoáº·c sao chÃ©p thá»§ cÃ´ng.');
    return false;
  } finally {
    document.body.removeChild(textArea);
  }
}
(() => {
  const raw = kgLoadDescStore();
  const norm = kgNormalizeStore(raw);
  if (norm.changed) kgSaveDescStore(norm.store);
})();
</script>
</body>
</html>
